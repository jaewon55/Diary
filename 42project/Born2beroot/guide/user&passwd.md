# User&Passwd
## subject
#### 사용자
+ root사용자 외에도 인트라ID를 사용하는 사용자가 있어야 한다.
+ 이 사용자는 user42 및 sudo 그룹에 속해 있어야 한다.
+ defense에 그룹을 할당한 새로운 사용자를 만들어야 한다.
#### 암호
+ 암호는 30일 마다 만료되어야 한다.
+ 암호 수정 전까지 허용되는 최소 일수는 2일로 한다.
+ 암호 만료되기 7일 전에 경고 메세지를 받아야 한다.
+ 암호는 10자 이상이고 대문자 및 숫자를 포함해야한다. 또한 3개 이상 동일한 문자가 연속 되어서는 안된다.
+ 비밀번호에는 사용자 이름이 포함되어선 안된다.
+ 이전 비밀번호와 최소 7자 이상 달라야한다.(root의 경우 제외)
+ 구성 파일을 설정한 후 root를 포함해 virtual machine에 있는 계정의 암호를 모두 변경해야 한다.
****
## 사용자 및 그룹 관리
#### 그룹 설정
+ **그룹 목록은 /etc/group 파일에 저장된다.**
```
grep jaewchoi /etc/group
```
+ **사용자가 속한 그룹 확인**
```
groupadd user42
// groupdel user42 그룹 삭제
```
+ **user42그룹 추가**
```
gpasswd -a jaewchoi user42
// gpasswd -d jaewchoi user42 그룹에서 사용자 제외
```
+ **user42(그룹)에 jaewchoi(사용자)를 추가한다.**
```
gpasswd -a jaewchoi sudo
```
+ **sudo그룹에 사용자 추가(sudo명령어 사용가능)**

#### 새로운 사용자 추가
```
vim /etc/default/useradd
```
+ **useradd명령어로 추가되는 계정의 기본셀을 bash셀로 설정**
```
mkdir /home/newuser
```
+ **새로운 계정의 home디렉터리 추가**
```
useradd -d /home/newuser newuser
```
+ **새로운 계정 생성**
```
passwd newuser
```
+ **새로운 계정의 비밀번호 지정**
****
## 사용자 비밀번호 관리
#### passwd명령어
+ **passwd \[option\] \[계정\] : 기본적으로 비밀번호를 변경하는 명령이지만 계정을 사용하지 못하게 하거나, 패스워드 만기일 및 유효기간 등을 설정할 수 있다.**
+ **옵션**
    + -a : all이라는 뜻으로 -S옵션과 같이 쓰여 모든 사용자에 대한 비밀번호 정보를 보여준다.
    + -S : satus 사용자에 대한 비밀번호 정보를 알 수 있다.
    + -l : lock 사용자의 비밀번호에 잠금을 걸어 로그인을 막는다.
    + -u : unlock 사용자에게 설정되어 있는 잠금을 푼다.
    + -n : 패스워드 변경까지의 최소 날짜를 설정한다. 패스워드 변경 후 최소로 사용해야 되는 날짜수
    + -x : 현재 패스워드의 유효기간을 지정한다.
    + -w : 패스워드 만료 전 경고 날짜를 지정한다.
    + -i : 패스워드 만료된 뒤 사용자 계정 사용이 실제 로그인이 불가능하게 되기까지 유예기간을 설정
    + -e : 다음 로그인 시에 반드시 패스워드를 변경하도록 할 때 사용한다.
+ **-S옵션의 7개 필드**
    ```
    1. 유저 로그인명
    2. L(비밀번호 잠김), NP(비밀번호 없음), P(사용가능한 비밀번호)
    3. 가장 최근에 변경된 일자
    4. 비밀번호 변경까지 최소 일자
    5. 비밀번호 변경까지 최대 일자
    6. 비밀번호 만료를 알리는 경고 기간
    7. 비밀번호가 만료되고 비밀번호가 잠기기까지의 유예기간
    ```

#### chage명령어
+ **chage \[optioin\] \[계정\] : 비밀번호 관련 저장 파일(/etc/shadow)의 날짜 관련 필드 설정을 모두 할 수 있는 명령어**
+ **옵션**
    + -l : 사용자의 비밀번호에 대한 정보를 보여준다.
    + -d : 최근 비밀번호를 바꾼 날을 수정한다.
    + -m : 비밀번호 변경의 최소 날짜를 지정한다.
    + -M : 비밀번호 변경 없이 사용 가능한 최대 날짜를 지정한다.
    + -I : 비밀번호 만료 후 잠금까지 유예기간을 지정한다.
    + -E : 계정이 만기되는 날을 지정한다.
    + -W : 비밀번호 만료 전 변경을 요구하는 경고 날짜를 지정한다.
****
## 비밀번호 정책 설정
#### 날짜관련 설정
```
vim /etc/login.defs
```
+ **/etc/login.defs : 비밀번호 default 설정파일**
    + `PASS_MAX_DAYS` : 비밀번호 유효기간 설정 30
    + `PASS_MIN_DAYS` : 비밀번호 최소 사용기간 2
    + `PASS_WARN_AGE` : 만료기간전 경고메세지 전송일 수 7

#### 암호정책 설정
+ **암호정책은 /etc/pam.d/common-password 파일에서 설정한다.**
```
apt install libpam-cracklib
```
+ **libpam-cracklib 설치 (비밀번호의 강도를 설정하고 검토하는 모듈)**
```
vim /etc/pam.d/common-password
```
+ **cracklib에 아래와 같이 설정한다.**
```
minlen=10 difok=7 dcredit=-1 ucredit=-1 maxrepeat=3 reject_username enforce_for_root
```
+ **cracklib 옵션**
+ debug : 모듈이 동작을 보여주기 위해 syslog에 정보를 남긴다.
+ type=LINUX : 모듈의 기본 동작은 패스워드를 물어 볼때 LINUX라고 바꿀
+ retry=N : 암호 입력 재시도 가능 횟수
+ difok=N : 이전 암호와 비교해서 최소 N개 이상의 문자가 달라야 함
+ minlen=N : 암호의 최소 길이 설정
+ dcredit=N : (N < 0) 암호가 포함해야하는 숫자의 최소 개수</br>(N >= 0) 숫자가 가질 수 있는 크레딧값의 최대값
+ ucredit=N : (N < 0) 암호가 포함해야하는 대문자의 최소 개수</br>(N >= 0) 대문자가 가질 수 있는 크레딧값의 최대값
+ lcredit=N : (N < 0) 암호가 포함해야하는 소문자의 최소 개수</br>(N >= 0) 소문자가 가질 수 있는 크레딧값의 최대값
+ ocredit=N : (N < 0) 암호가 포함해야하는 숫자의 특수문자 개수</br>(N >= 0) 특수문자가 가질 수 있는 크레딧값의 최대값
+ minclass=N : 암호에 있어야 하는 최소 문자 종류
+ maxrepeat=N : 연속된 같은 문자를 N개까지만 허용
+ maxsequence=N : 단순한 나열의 문자를 N개까지만 허용
+ maxclassrepeat=N : 같은 종류의 문자를 N개까지만 허용
+ reject_username : 암호가 계정의 이름을 포함하는지 검사
+ enforce_for_root : root계정에도 상기의 옵션을 적용